> 生成时间: 2026-01-07 19:03

# 二维下料问题工程规范

> 本文档定义二维下料问题的术语、切割工艺和数学建模规范,供编程和学习参考。

---

## 1. 坐标系与尺寸定义

### 1.1 坐标系

**原点**: 左下角
**X轴**: 向右为正 (长度方向)
**Y轴**: 向上为正 (宽度方向)

```
        Y (宽度)
        ▲
        │    ┌──────────────────────────────────────────────────────────┐
        │    │                                                          │
        │    │                      母板/子板                            │
        │    │                    (长度 >= 宽度)                         │
        │    │                                                          │
        └────┴──────────────────────────────────────────────────────────┴───────▶ X (长度)
       O(0,0)
       原点
```

### 1.2 方向定义

| 方向 | 轴 | 名称 | 说明 |
|:----:|:--:|:----:|:-----|
| 水平 (左右) | X | 长度 Length | 切割延伸方向 |
| 垂直 (上下) | Y | 宽度 Width | 切割分离方向 |

**约束**: 长度 >= 宽度 (对母板和子板均成立)

### 1.3 术语定义

| 术语 | 英文 | 定义 |
|:----:|:----:|:-----|
| 母板 | Stock | 待切割的原始大板材,尺寸 W x L |
| 子板 | Item | 从母板切出的目标板材,尺寸 w x l |
| 子板类型 | Item Type | 相同尺寸的子板归为一类,有需求量 d |
| 条带 | Strip | 切割过程中的中间产物 |

---

## 2. 两阶段切断式切割

### 2.1 切割流程

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    【第一阶段】                                       │
│                              母板 ──→ 条带 (水平切割)                                 │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌───────────────────────────────────┐    ┌───────────────────────────────────┐   │
│   │                                   │    │           顶部余料                 │   │
│   │                                   │    ├───────────────────────────────────┤   │
│   │                                   │    │ 条带3 (窄)                         │   │
│   │            母 板                  │ ─→ ├───────────────────────────────────┤   │
│   │                                   │    │ 条带2 (中)                         │   │
│   │                                   │    ├───────────────────────────────────┤   │
│   │                                   │    │ 条带1 (最宽)                       │   │
│   └───────────────────────────────────┘    └───────────────────────────────────┘   │
│   ▲ 原点在左下角                            ▲ 条带紧密堆叠, 从底部开始               │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    【第二阶段】                                       │
│                              条带 ──→ 子板 (垂直切割)                                 │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌───────────────────────────────────┐    ┌────────┬──────┬──────┬────────────┐   │
│   │                                   │    │ 余料1  │余料2 │余料3 │            │   │
│   │            条 带                  │ ─→ ├────────┼──────┼──────┤  右侧余料  │   │
│   │                                   │    │ 子板1  │子板2 │子板3 │            │   │
│   └───────────────────────────────────┘    └────────┴──────┴──────┴────────────┘   │
│   ▲ 原点在左下角                            ▲ 子板底部对齐, 各自上方有独立余料        │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 条带的定义与结构

条带是切割过程中的**中间概念**,由其最左侧的子板(初始化子板)定义:

**关键规则**:
1. **条带宽度** = 初始化子板的宽度
2. **后续子板宽度** <= 条带宽度 (可以小于)
3. **对齐方式**: 所有子板底部对齐条带下沿 (Y坐标相同)
4. **放置顺序**: 从左到右依次放置

**条带类型**: 理论上,条带类型数 = 不同子板宽度数 (每种子板宽度对应一种条带类型)。
实际切割方案中是否使用某种条带类型,取决于求解器的优化结果。

```
     ┌────────────────┬──────────────┬────────────┬──────────────┬─────────────────────────────────┐
     │                │  余料A (小)  │ 余料B (中) │  余料C (大)  │                                 │
     │                ├──────────────┼────────────┤              │                                 │  ▲
     │   初始化子板   │              │            ├──────────────┤                                 │  │ 条带宽度
     │    (w=W)       │    子板A     │   子板B    │    子板C     │           右侧余料              │  │   W
     │   无上方余料   │   (w略<W)    │  (w中等)   │   (w较小)    │                                 │  │   =
     ├────────────────┴──────────────┴────────────┴──────────────┴─────────────────────────────────┤  │ 初始化
     │                              ▲ 所有子板底部对齐条带下沿                                       │  ▼ 子板宽度
     └─────────────────────────────────────────────────────────────────────────────────────────────┘
     <───────────────────────────────────── 条带长度 = 母板长度 ──────────────────────────────────────>

     注: 长度 > 宽度; 竖直切断式切割, 每一刀从上切到下, 子板与其上方余料一起被切下
```

### 2.3 余料说明

| 余料类型 | 位置 | 产生原因 |
|:--------:|:----:|:---------|
| 上方余料 | 子板上方 | 子板宽度 < 条带宽度,子板贴下沿放置 |
| 右侧余料 | 条带右侧 | 子板长度之和 < 条带长度 |
| 顶部余料 | 母板顶部 | 条带宽度之和 < 母板宽度 |

---

## 3. 放置规则

### 3.1 对齐原则

**所有元素以左下角为基准点放置**:

| 元素 | 放置规则 |
|:----:|:---------|
| 条带在母板中 | 从母板底部(Y=0)开始,向上依次堆叠 |
| 子板在条带中 | 从条带左端(X=0)开始,向右依次排列 |
| 子板对齐方式 | 底部对齐条带下沿,上方可能有余料 |

### 3.2 宽度递减原则

实际生产中,采用**宽度递减**排列便于操作:

```
母板结构 (从下到上, 条带紧密堆叠, 宽度递减):

        ┌──────────────────────────────────────────────────────────────────────────────┐
        │                                 顶部余料                                      │
        ├──────────────────────────────────────────────────────────────────────────────┤  ▲
        │ 条带3 (窄)                                                                    │  │
        ├──────────────────────────────────────────────────────────────────────────────┤  │ 母板
        │ 条带2 (中)                                                                    │  │ 宽度
        ├──────────────────────────────────────────────────────────────────────────────┤  │  W
        │ 条带1 (最宽)                                                                  │  │
        └──────────────────────────────────────────────────────────────────────────────┘  ▼
        ▲
      (0,0) 原点
        <─────────────────────────────── 母板长度 L ──────────────────────────────────>


条带内子板排列 (从左到右, 宽度递减, 各自上方有独立余料):

        ┌──────────────┬────────────┬──────────┬────────┬──────────────────────────────┐
        │              │   余料2    │  余料3   │ 余料4  │                              │
        │  初始化子板  ├────────────┼──────────┤        │                              │  ▲ 条带宽度
        │   (子板1)    │   子板2    │  子板3   ├────────┤         右侧余料             │  │    =
        │  w = 条带宽度│   w < 条带 │  w < 条带│ 子板4  │                              │  │ 初始化子板
        │  无上方余料  │            │          │w < 条带│                              │  ▼   宽度
        └──────────────┴────────────┴──────────┴────────┴──────────────────────────────┘
        ▲
      从左端开始
        <─────────────────────────────── 条带长度 = 母板长度 ─────────────────────────>
```

---

## 4. 启发式算法 (FFD)

### 4.1 First Fit Decreasing 算法

```
┌─────────────────────────────────────────────────────────────────┐
│  输入: 子板列表 (类型, 尺寸, 需求量)                              │
│  输出: 切割方案                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 展开所有子板,按宽度降序排序                                   │
│                                                                 │
│  2. FOR 每个子板 DO                                              │
│       │                                                         │
│       ├─→ 尝试放入现有条带 (宽度<=条带宽度 且 长度足够)            │
│       │     │                                                   │
│       │     ├─ 成功: 放入,更新剩余长度                           │
│       │     │                                                   │
│       │     └─ 失败: 转到下一步                                  │
│       │                                                         │
│       └─→ 用该子板初始化新条带                                   │
│             │                                                   │
│             ├─ 当前母板宽度足够: 创建新条带                       │
│             │                                                   │
│             └─ 当前母板宽度不足: 开启新母板,再创建条带            │
│                                                                 │
│  3. 返回切割方案                                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 算法示例

```
输入:
  母板: 200(W) x 400(L)
  子板: A(150x200), B(150x180), C(120x150), D(100x100), E(80x90)

排序后 (按宽度降序): A(w=150) → B(w=150) → C(w=120) → D(w=100) → E(w=80)

执行过程:
  Step 1: A(150x200) → 初始化条带1(宽=150), 放入A, 剩余长度=200
  Step 2: B(150x180) → 放入条带1(150<=150), 剩余长度=20
  Step 3: C(120x150) → 条带1长度不足, 初始化条带2(宽=120), 剩余长度=250
  Step 4: D(100x100) → 放入条带2(100<=120), 剩余长度=150
  Step 5: E(80x90)   → 放入条带2(80<=120), 剩余长度=60

结果 (Y=0为底部, 长度400 > 宽度200):

        ┌───────────────────────────────────────────────────────────────────────────────────────┐
        │                                      顶部余料                                          │
        ├───────────────────────────────────────────────────────────────────────────────────────┤
        │                │  余料D (小)  │  余料E (大)  │                                         │  ▲
        │                ├──────────────┤              │                                         │  │
  Y=150 │   C (w=120)    │  D (w=100)   ├──────────────┤                  右侧余料               │  │ 条带2
        │   初始化子板   │              │   E (w=80)   │                                         │  │ 宽=120
        ├────────────────┴──────────────┴──────────────┴─────────────────────────────────────────┤  ▼
        ├────────────────────────────┬──────────────────────────┬────┬───────────────────────────┤  ▲
        │                            │                          │ 右 │                           │  │ 条带1
        │     A (w=150) 初始化子板   │       B (w=150)          │ 侧 │                           │  │ 宽=150
        │                            │                          │ 余 │                           │  │
        └────────────────────────────┴──────────────────────────┴────┴───────────────────────────┘  ▼
        ▲
      (0,0)

        说明: 条带2中D和E的宽度小于C, 竖直切割后D和E上方各有独立余料块
              条带1中A和B的宽度均等于条带宽度, 无上方余料
```

---

## 5. 数学模型

### 5.1 符号定义

| 类别 | 符号 | 含义 |
|:----:|:----:|:-----|
| 母板 | W, L | 母板宽度, 长度 |
| 子板 | w_i, l_i | 子板类型i的宽度, 长度 |
| | d_i | 子板类型i的需求量 |
| | N | 子板类型总数 |
| 条带 | w_j | 条带类型j的宽度 |
| | J | 条带类型总数 = 不同子板宽度数 |

### 5.2 列生成模型中的列定义

**Y列 (母板切割方案)**:
- 定义母板如何切割成条带
- pattern[j] = 切出的j型条带数量
- 目标函数系数 = 1 (最小化母板使用量)

**X列 (条带切割方案)**:
- 定义条带如何切割成子板
- strip_type_id = 所属条带类型 j
- pattern[i] = 切出的i型子板数量
- 约束: 只能包含 w_i <= w_j 的子板

### 5.3 约束条件

```
min  Σ Y_k                           (最小化母板数)

s.t. Σ C_jk·Y_k - Σ X_p >= 0         (条带平衡: 产出 >= 消耗)
     Σ B_ip·X_p >= d_i               (需求满足)
     Y_k, X_p >= 0, 整数
```

---

## 6. 文件规范

### 6.1 命名约定

| 文件类型 | 格式 | 示例 |
|:--------:|:----:|:-----|
| 算例 | inst_*.csv | inst_d1.06_20260107_011652.csv |
| 解 | solution_时间戳.json | solution_20260107_021326.json |
| 日志 | log_项目名_时间戳.log | log_2DBP_Arc_20260107_011708.log |

### 6.2 算例文件格式 (CSV)

```csv
# 二维下料问题算例
stock_width,stock_length
200,400
id,width,length,demand
0,150,200,3
1,120,150,5
...
```

---

## 7. 相关项目

| 项目 | 路径 | 说明 |
|:----:|:----:|:-----|
| CS-2D-BP-Arc | YM-Code/CS-2D-BP-Arc | 分支定价求解器 |
| CS-2D-Data | YM-Code/CS-2D-Data | 算例数据集 |

---

**版本**: 1.1
**日期**: 2026-01-07
**作者**: Claude Code
